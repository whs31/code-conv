---
title: Используемый стандарт
---
# Используемый стандарт С++, компилятор и расширения
### Стандарт C++
На данный момент основным используемым стандартом является **C++20** с незначительными отсутствующими частями стандартной библиотеки.

> Для разработчиков под *Astra Linux SE 1.6* максимально высоким стандартом С++ является **C++14** без расширений.

Не допускается использование следующих заголовочных файлов стандартной библиотеки:
- `format` - вместо `std::format` рекомендуется использовать `fmt::format` из библиотеки `fmt` (доступна в [нашем репозитории](http://uav.radar-mms.com/ui/packages/conan:%2F%2Ffmt?projectKey=radar))
- `source_location` - вместо `std::source_location` рекомендуется использовать библиотеку `Boost`.

Модули из С++20 в данный момент не поддерживаются используемой версией *CMake*, поэтому их использование также запрещено (в т.ч. замена директивы `#include` на ключевое слово `import`)

### Компилятор 
Основным используемым компилятором является **GCC 10.2.0**. В роли резервного компилятора выступает **Clang 15**.

Правильно написанная библиотека/приложение должно компилироваться **всеми основными компиляторами** (*GCC* → *Clang* → *MSVC* в порядке убывания приоритета)

### Нестандартные расширения компилятора
#### Атрибуты GCC
Атрибуты (ключевое слово `__attribute__`) находятся под запретом, так как не поддерживаются компиляторами, отличными от GCC.

##### Как заменить `__attribute__((constuctor))`?

Этот атрибут обычно используется для автоматического вызова какой-либо свободной функции **при линковке**.
###### Неправильный код
```cpp 
auto __attribute__((constructor)) print_version() -> void {
	fmt::print("loaded library {} version {}.{}", 
		PROJECT_NAME, 
		PROJECT_VERSION_MAJOR,
		PROJECT_VERSION_MINOR
	);
}
```
Данный код не будет скомпилирован компиляторами MSVC и, потенциально, Clang.

###### Правильный код
```cpp
struct constructor {
	explicit constructor(void (*f)(void)) { f(); }
}

static constructor print_version(+[]() -> void {
	fmt::print("loaded library {} version {}.{}", 
		PROJECT_NAME, 
		PROJECT_VERSION_MAJOR,
		PROJECT_VERSION_MINOR
	);
});
```
Семантический смысл остается тем же, но этот вариант скомпилируется любым из современных компиляторов С++. 
Если вам требуется вызывать `constructor` часто, то `struct constructor` можно параметризировать через шаблон.

##### Как заменить `__attribute__((packed))`?
Этот атрибут используется для того, чтобы убрать паддинг (отступ) между членами внутри структуры.
###### Неправильный код
```cpp
struct Data 
{
	int a;
	bool b;
	float c;
	long long d;
} __attribute__((packed));
```
###### Правильный код
```cpp
#pragma pack(push, 1)
struct [[gnu::packed]] Data 
{
	int a;
	bool b;
	float c;
	long long d;
};
#pragma pack(pop)
```